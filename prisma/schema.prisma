generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(BUYER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  projects  Project[]
  bids      Bid[]
}

model Project {
  id            Int      @id @default(autoincrement())
  title         String
  description   String
  budgetMin     Float
  budgetMax     Float
  deadline      DateTime
  buyerId       Int
  buyer         User     @relation(fields: [buyerId], references: [id])
  bids          Bid[]
  status        ProjectStatus @default(OPEN)
  selectedBidId Int?          @unique // Add @unique to ensure one-to-one relation
  selectedBid   Bid?          @relation("SelectedBid", fields: [selectedBidId], references: [id])
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model Bid {
  id              Int      @id @default(autoincrement())
  amount          Float
  message         String?  @default("")
  projectId       Int
  project         Project  @relation(fields: [projectId], references: [id])
  sellerId        Int
  seller          User     @relation(fields: [sellerId], references: [id])
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  selectedProject Project? @relation("SelectedBid") // One-to-one relation with Project
}

enum Role {
  BUYER
  SELLER
}

enum ProjectStatus {
  OPEN
  ASSIGNED
  COMPLETED
}